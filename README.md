<br />
<div align="center">
  <a href="https://github.com/RemiMahmoud/TrustMe">
    <img src="man/figures/trustme_hexlogo.png" alt="Logo" width="244" height="284">
  </a>

  <h3 align="center">TrustMe</h3>

  <p align="center">
    <i> </i>
</div>

<!-- badges: start -->
<!-- badges: end -->

The goal of TrustMe is to enhance confidence in LLM-generated responses, particularly within
the [NaileR](https://cran.r-project.org/web/packages/NaileR/index.html) ecosystem.


Thanks to the Ollama API that allows to use Large Language Model (LLM) locally, 
we developed a small package that uses the output of the <a href="https://CRAN.R-project.org/package=NaileR">'NaileR' package</a> which aims to assess different types of consistencies:

* *Cross-model consistency*: Assesses the similarity of responses generated by *different LLMs* for the same prompt.
* *Internal-model consistency*: Evaluates the stability of a model *via* its responses by comparing *multiple calls* to the same LLM with the same prompt.
* *Data-model consistency*: Measures the similarity of responses generated from *siblings prompts* (possibly generated by NaileR).  

For all these purposes, *TrustMe* provides several key outputs, mainly based on the embeddings of the responses (hence the name of the package):

- A *"central" response* that summarizes the set of generated responses.
- A *graphical representation* of responses' variability.
- A set of *uncertainty scores* computed using metrics such as *eccentricity*, *eigenvalue sum of the graph Laplacian* based on [this paper from Lin et al., 2024](https://arxiv.org/abs/2305.19187) etc..


## Installation

You can install the development version of TrustMe like so:

``` r
devtools::install_github("RemiMahmoud/TrustMe")
```

## Example




This is a basic example which shows you how to solve a common problem:

``` r
library(TrustMe)
library(NaileR)

data(beard_cont, package = "NaileR")
intro_beard <- 'A survey was conducted about beards
and 8 types of beards were described.
In the data that follow, beards are named B1 to B8.'
intro_beard <- gsub('\n', ' ', intro_beard) |>
  stringr::str_squish()

req_beard <- 'Please give a name to each beard
and summarize what makes this beard unique.'
req_beard <- gsub('\n', ' ', req_beard) |>
  stringr::str_squish()

# prompt generation
res_beard <- nail_descfreq(beard_cont,
                           introduction = intro_beard,
                           request = req_beard,
                           generate = FALSE)
res_beard

#######################
# models comparison
#######################

res_trustme_cross_model_consistency <- trustme_models(res_beard, models = c("llama2", "llama3", "llama3.1","mistral"))
names(res_trustme_cross_model_consistency)
cat(res_trustme_cross_model_consistency$central_answer[[1]])
res_trustme_cross_model_consistency$pca_plot

##########################
# repetitions comparison
##########################
res_trustme_internal_model_consistency <- trustme_models(res_beard, models = "llama3.1", num_repeats = 5)
cat(res_trustme_internal_model_consistency$central_answer[[1]])
res_trustme_internal_model_consistency$pca_plot


###########################
# uncertainty computation
###########################

res_uncertainty <- compute_uncertainty_metrics(unlist(res_trustme_internal_model_consistency$responses))

# Plot uncertainty
library(ggplot2)
theme_set(theme_bw())
cowplot::plot_grid(plotlist = plot_uncertainty(res_uncertainty))

```

